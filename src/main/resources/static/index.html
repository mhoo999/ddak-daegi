<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>API 시나리오 테스트</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 40px; background: #f7f7f7; }
        h1 { color: #333; }
        h2 { margin-top: 32px; color: #1976d2; }
        .api-block { background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #eee; margin-bottom: 32px; padding: 24px; }
        .api-item { margin-bottom: 18px; }
        label { display: inline-block; min-width: 90px; }
        input, select { padding: 4px 8px; margin-right: 8px; }
        button { padding: 6px 16px; border-radius: 4px; border: none; background: #1976d2; color: #fff; cursor: pointer; }
        button:disabled { background: #aaa; }
        .result { margin-top: 8px; font-size: 0.95em; color: #444; background: #f9f9f9; padding: 8px; border-radius: 4px; border: 1px solid #eee; }
        .flex { display: flex; align-items: center; gap: 8px; }
    </style>
</head>
<body>
    <h1>API 시나리오 테스트</h1>

    <!-- 1. 회원가입/로그인 -->
    <div class="api-block">
        <h2>1. 회원가입</h2>
        <div class="api-item flex">
            <label>아이디</label><input id="register-username">
            <label>비밀번호</label><input id="register-password" type="password">
            <button onclick="register()">회원가입</button>
        </div>
        <div class="result" id="result-register"></div>

        <h2>2. 로그인</h2>
        <div class="api-item flex">
            <label>아이디</label><input id="login-username">
            <label>비밀번호</label><input id="login-password" type="password">
            <button onclick="login()">로그인</button>
        </div>
        <div class="result" id="result-login"></div>
    </div>

    <!-- 2. 상품 등록/조회 -->
    <div class="api-block">
        <h2>3. 상품 등록</h2>
        <div class="api-item flex">
            <label>상품명</label><input id="product-name">
            <label>가격</label><input id="product-price" type="number">
            <button onclick="createProduct()">상품 등록</button>
        </div>
        <div class="result" id="result-product-create"></div>

        <h2>4. 상품 전체 조회</h2>
        <div class="api-item flex">
            <button onclick="getProducts()">상품 목록 조회</button>
        </div>
        <div class="result" id="result-products"></div>
    </div>

    <!-- 3. 주문 생성/조회 -->
    <div class="api-block">
        <h2>5. 주문 생성</h2>
        <div class="api-item flex">
            <label>프로모션ID</label><input id="order-promotion-id" type="number">
            <label>상품ID</label><input id="order-product-id" type="number">
            <label>수량</label><input id="order-qty" type="number" value="1">
            <button onclick="createOrder()">주문 생성</button>
        </div>
        <div class="result" id="result-order-create"></div>

        <h2>6. 주문 전체 조회</h2>
        <div class="api-item flex">
            <button onclick="getOrders()">주문 목록 조회</button>
        </div>
        <div class="result" id="result-orders"></div>
    </div>

    <!-- 4. 프로모션 등록/조회 -->
    <div class="api-block">
        <h2>7. 프로모션 등록</h2>
        <div class="api-item flex">
            <label>이름</label><input id="promotion-name">
            <label>시작일</label><input id="promotion-start" type="date">
            <label>종료일</label><input id="promotion-end" type="date">
            <button onclick="createPromotion()">프로모션 등록</button>
        </div>
        <div class="result" id="result-promotion-create"></div>

        <h2>8. 프로모션 전체 조회</h2>
        <div class="api-item flex">
            <button onclick="getPromotions()">프로모션 목록 조회</button>
        </div>
        <div class="result" id="result-promotions"></div>
    </div>

    <!-- 5. 이미지 업로드 -->
    <div class="api-block">
        <h2>9. 이미지 업로드</h2>
        <div class="api-item flex">
            <input type="file" id="image-file">
            <label>타입</label><input id="image-type">
            <button onclick="uploadImage()">이미지 업로드</button>
        </div>
        <div class="result" id="result-image-upload"></div>
    </div>

    <script>
        let accessToken = '';

        function setResult(id, text) {
            document.getElementById(id).innerText = text;
        }

        // 회원가입
        function register() {
            setResult('result-register', '요청 중...');
            fetch('/api/v1/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: document.getElementById('register-username').value,
                    password: document.getElementById('register-password').value
                })
            })
            .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
            .then(res => setResult('result-register', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2)))
            .catch(err => setResult('result-register', '에러: ' + err));
        }

        // 로그인
        function login() {
            setResult('result-login', '요청 중...');
            fetch('/api/v1/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: document.getElementById('login-username').value,
                    password: document.getElementById('login-password').value
                })
            })
            .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
            .then(res => {
                setResult('result-login', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2));
                if(res.data) accessToken = res.data; // 토큰 저장
            })
            .catch(err => setResult('result-login', '에러: ' + err));
        }

        // 상품 등록
        function createProduct() {
            setResult('result-product-create', '요청 중...');
            fetch('/api/v1/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + accessToken
                },
                body: JSON.stringify({
                    name: document.getElementById('product-name').value,
                    price: Number(document.getElementById('product-price').value)
                })
            })
            .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
            .then(res => setResult('result-product-create', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2)))
            .catch(err => setResult('result-product-create', '에러: ' + err));
        }

        // 상품 전체 조회
        function getProducts() {
            setResult('result-products', '요청 중...');
            fetch('/api/v1/products')
                .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
                .then(res => setResult('result-products', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2)))
                .catch(err => setResult('result-products', '에러: ' + err));
        }

        // 주문 생성
        function createOrder() {
            setResult('result-order-create', '요청 중...');
            fetch('/api/v1/orders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + accessToken
                },
                body: JSON.stringify({
                    promotionId: Number(document.getElementById('order-promotion-id').value),
                    promotionProductRequests: [
                        {
                            productId: Number(document.getElementById('order-product-id').value),
                            quantity: Number(document.getElementById('order-qty').value)
                        }
                    ]
                })
            })
            .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
            .then(res => setResult('result-order-create', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2)))
            .catch(err => setResult('result-order-create', '에러: ' + err));
        }

        // 주문 전체 조회
        function getOrders() {
            setResult('result-orders', '요청 중...');
            fetch('/api/v1/orders', {
                headers: { 'Authorization': 'Bearer ' + accessToken }
            })
                .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
                .then(res => setResult('result-orders', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2)))
                .catch(err => setResult('result-orders', '에러: ' + err));
        }

        // 프로모션 등록
        function createPromotion() {
            setResult('result-promotion-create', '요청 중...');
            fetch('/api/v1/promotions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: document.getElementById('promotion-name').value,
                    startDate: document.getElementById('promotion-start').value,
                    endDate: document.getElementById('promotion-end').value
                })
            })
            .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
            .then(res => setResult('result-promotion-create', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2)))
            .catch(err => setResult('result-promotion-create', '에러: ' + err));
        }

        // 프로모션 전체 조회
        function getPromotions() {
            setResult('result-promotions', '요청 중...');
            fetch('/api/v1/promotions')
                .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
                .then(res => setResult('result-promotions', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2)))
                .catch(err => setResult('result-promotions', '에러: ' + err));
        }

        // 이미지 업로드
        function uploadImage() {
            setResult('result-image-upload', '요청 중...');
            const fileInput = document.getElementById('image-file');
            const type = document.getElementById('image-type').value;
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('type', type);
            fetch('/api/v1/images', {
                method: 'POST',
                body: formData
            })
            .then(res => res.json().then(data => ({ ok: res.ok, status: res.status, data })))
            .then(res => setResult('result-image-upload', 'Status: ' + res.status + '\n' + JSON.stringify(res.data, null, 2)))
            .catch(err => setResult('result-image-upload', '에러: ' + err));
        }
    </script>
</body>
</html> 